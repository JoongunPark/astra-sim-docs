<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Argument ${WORKLOAD_CONFIG} &mdash; ASTRA-sim 2.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=f35be339"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Argument ${SYSTEM_CONFIG}" href="argument-system-config.html" />
    <link rel="prev" title="Run ASTRA-sim" href="running-astra-sim.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ASTRA-sim
          </a>
              <div class="version">
                latest
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="getting-started.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="setup.html">Dependencies Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing-astra-sim.html">Build ASTRA-sim</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="running-astra-sim.html">Run ASTRA-sim</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Argument ${WORKLOAD_CONFIG}</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-execution-trace-generator-et-generator">Using Execution Trace Generator (et_generator)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-execution-trace-converter-et-converter">Using Execution Trace Converter (et_converter)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-chakra-execution-trace-and-kineto-traces-generated-by-pytorch">Using Chakra Execution Trace and Kineto Traces Generated By PyTorch</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-roofline-models">Enable Roofline Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-communicator-groups">Enable Communicator Groups</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="argument-system-config.html">Argument ${SYSTEM_CONFIG}</a></li>
<li class="toctree-l3"><a class="reference internal" href="argument-network-config.html">Argument ${NETWORK_CONFIG}</a></li>
<li class="toctree-l3"><a class="reference internal" href="argument-memory-config.html">Argument ${MEMORY_CONFIG}</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="astra-sim-output.html">ASTRA-sim Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../system-layer/system-layer.html">System Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network-backend/network-backend.html">Network Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../memory-backend/memory-backend.html">Memory Backend</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ASTRA-sim</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="getting-started.html">Getting Started</a></li>
          <li class="breadcrumb-item"><a href="running-astra-sim.html">Run ASTRA-sim</a></li>
      <li class="breadcrumb-item active">Argument ${WORKLOAD_CONFIG}</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/getting-started/argument-workload-config.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="argument-workload-config">
<h1>Argument ${WORKLOAD_CONFIG}<a class="headerlink" href="#argument-workload-config" title="Link to this heading"></a></h1>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">--workload-configuration: path to the prefix of execution trace files</span>
</pre></div>
</div>
<p>The naming rule for execution traces follows the format {path_prefix}.{npu_id}.et.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Execution traces can be created using <a class="reference external" href="https://github.com/mlcommons/chakra/blob/main">Chakra tools</a>. You have the option of using either execution trace generator (et_generator) or execution trace converter (et_converter).</p>
</div>
<section id="using-execution-trace-generator-et-generator">
<h2>Using Execution Trace Generator (et_generator)<a class="headerlink" href="#using-execution-trace-generator-et-generator" title="Link to this heading"></a></h2>
<p>et_generator can be used to define and generate any execution traces, functioning as a test case generator. You can generate execution traces with the following commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">ASTRA_SIM</span><span class="si">}</span>/extern/graph_frontend/chakra/et_generator
<span class="gp">$ </span>cmake<span class="w"> </span>CMakeLists.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
<span class="gp">$ </span>./et_generator<span class="w"> </span>--num_npus<span class="w"> </span><span class="m">64</span><span class="w"> </span>--num_dims<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">ASTRA_SIM</span><span class="si">}</span>/extern/graph_frontend/chakra
$<span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>.
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>chakra.et_generator.et_generator<span class="w"> </span>--num_npus<span class="w"> </span><span class="m">64</span><span class="w"> </span>--num_dims<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<p>To run one of the example traces (<code class="docutils literal notranslate"><span class="pre">one_comm_coll_node_allreduce</span></code>), execute the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For the analytical network backend</span>
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-
$<span class="w"> </span>./build/astra_analytical/build/bin/AstraSim_Analytical_Congestion_Unaware<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--workload-configuration<span class="o">=</span>./extern/graph_frontend/chakra/one_comm_coll_node_allreduce<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--system-configuration<span class="o">=</span>./inputs/system/Switch.json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--network-configuration<span class="o">=</span>./inputs/network/analytical/Switch.yml<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--remote-memory-configuration<span class="o">=</span>./inputs/remote_memory/analytical/no_memory_expansion.json

<span class="c1"># For the ns3 network backend. Python2 required.</span>
<span class="c1"># After editing the configuration files in the following script</span>
$<span class="w"> </span>./build/astra_ns3/build.sh<span class="w"> </span>-r

<span class="c1"># Or, alternatively:</span>
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>./extern/network_backend/ns3/simulation
$<span class="w"> </span>./waf<span class="w"> </span>--run<span class="w"> </span><span class="s2">&quot;scratch/AstraSimNetwork \</span>
<span class="s2">  --workload-configuration=../../../../extern/graph_frontend/chakra/one_comm_coll_node_allreduce \</span>
<span class="s2">  --system-configuration=../../../../inputs/system/Switch.json \</span>
<span class="s2">  --network-configuration=mix/config.txt \</span>
<span class="s2">  --remote-memory-configuration=../../../../inputs/remote_memory/analytical/no_memory_expansion.json \</span>
<span class="s2">  --logical-topology-configuration=../../../../inputs/network/ns3/sample_64nodes_1D.json \</span>
<span class="s2">  --comm-group-configuration=\&quot;empty\&quot;&quot;</span>
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-
</pre></div>
</div>
<p>Upon completion, ASTRA-sim will display the number of cycles it took to run the simulation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sys<span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span>finished,<span class="w"> </span><span class="m">50904</span><span class="w"> </span>cycles
sys<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>finished,<span class="w"> </span><span class="m">50904</span><span class="w"> </span>cycles
...
sys<span class="o">[</span><span class="m">62</span><span class="o">]</span><span class="w"> </span>finished,<span class="w"> </span><span class="m">50904</span><span class="w"> </span>cycles
sys<span class="o">[</span><span class="m">63</span><span class="o">]</span><span class="w"> </span>finished,<span class="w"> </span><span class="m">50904</span><span class="w"> </span>cycles
</pre></div>
</div>
</section>
<section id="using-execution-trace-converter-et-converter">
<h2>Using Execution Trace Converter (et_converter)<a class="headerlink" href="#using-execution-trace-converter-et-converter" title="Link to this heading"></a></h2>
<p>You can convert ASTRA-sim 1.0 text input files into Chakra traces with the following commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>./extern/graph_frontend/chakra/
$<span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>.
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>chakra.et_converter.et_converter<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--input_type<span class="w"> </span>Text<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--input_filename<span class="w"> </span>../../../inputs/workload/ASTRA-sim-1.0/Resnet50_DataParallel.txt<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output_filename<span class="w"> </span>../../../inputs/workload/ASTRA-sim-2.0/Resnet50_DataParallel<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num_npus<span class="w"> </span><span class="m">64</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num_dims<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num_passes<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<p>Run the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-
$<span class="w"> </span>./build/astra_analytical/build/bin/AstraSim_Analytical_Congestion_Unaware<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--workload-configuration<span class="o">=</span>./inputs/workload/ASTRA-sim-2.0/Resnet50_DataParallel<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--system-configuration<span class="o">=</span>./inputs/system/Switch.json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--network-configuration<span class="o">=</span>./inputs/network/analytical/Switch.yml<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--remote-memory-configuration<span class="o">=</span>./inputs/remote_memory/analytical/no_memory_expansion.json

<span class="c1"># Similarly, for ns3, run the previous command while only changing the workload.</span>
</pre></div>
</div>
<p>Upon completion, ASTRA-sim will display the number of cycles it took to run the simulation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sys<span class="o">[</span><span class="m">62</span><span class="o">]</span><span class="w"> </span>finished,<span class="w"> </span><span class="m">6749042</span><span class="w"> </span>cycles
sys<span class="o">[</span><span class="m">61</span><span class="o">]</span><span class="w"> </span>finished,<span class="w"> </span><span class="m">6749042</span><span class="w"> </span>cycles
...
sys<span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span>finished,<span class="w"> </span><span class="m">6749042</span><span class="w"> </span>cycles
sys<span class="o">[</span><span class="m">63</span><span class="o">]</span><span class="w"> </span>finished,<span class="w"> </span><span class="m">6749042</span><span class="w"> </span>cycles
</pre></div>
</div>
</section>
<section id="using-chakra-execution-trace-and-kineto-traces-generated-by-pytorch">
<h2>Using Chakra Execution Trace and Kineto Traces Generated By PyTorch<a class="headerlink" href="#using-chakra-execution-trace-and-kineto-traces-generated-by-pytorch" title="Link to this heading"></a></h2>
<p>By adding a few lines to any PyTorch workload, you can generate the PyTorch Execution Trace (ET) and Kineto traces for each GPU (and its corresponding CPU thread).
Details on how to tweak the PyTorch files to get PyTorch-ET and Kineto traces can be found elsewhere (we’ll throw in some guidelines later).
With these traces for each GPU, we merge the PyTorch-ET and Kineto trace into a single enhanced ET.
From there, it’s all about feeding this enhanced ET into a converter that converts the enhanced ET into the Chakra format.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, navigate to the param submodule where you&#39;ll find sample Pytorch-ET and Kineto input files and that handy merger script</span>
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>extern/graph_frontend/param/train/compute/python/
$<span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
$<span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>.

<span class="c1"># Second, unzip the input files</span>
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>./test/data
$<span class="w"> </span>tar<span class="w"> </span>-xzf<span class="w"> </span>dlrm_kineto.tar.gz
$<span class="w"> </span>tar<span class="w"> </span>-xzf<span class="w"> </span>dlrm_pytorch_et.tar.gz
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>../../

<span class="c1"># Now, we&#39;ll fire up the script that leverages the already whipped up Pytorch-ET+Kineto traces (from a single training loop of DLRM on 8 GPUs) and fuses them into that enhanced ET we keep talking about</span>
$<span class="w"> </span>python3<span class="w"> </span>./tools/trace_link.py<span class="w"> </span>--et-file<span class="w"> </span>test/data/dlrm_pytorch_et/dlrm_eg_0.json<span class="w"> </span>--kineto-file<span class="w"> </span>test/data/dlrm_kineto/worker0*<span class="w"> </span>--exact-match<span class="w"> </span>--annotation<span class="w"> </span><span class="s1">&#39;enumerate(DataLoader)#_MultiProcessingDataLoaderIter.__next__&#39;</span>
$<span class="w"> </span>python3<span class="w"> </span>./tools/trace_link.py<span class="w"> </span>--et-file<span class="w"> </span>test/data/dlrm_pytorch_et/dlrm_eg_1.json<span class="w"> </span>--kineto-file<span class="w"> </span>test/data/dlrm_kineto/worker1*<span class="w"> </span>--exact-match<span class="w"> </span>--annotation<span class="w"> </span><span class="s1">&#39;enumerate(DataLoader)#_MultiProcessingDataLoaderIter.__next__&#39;</span>
$<span class="w"> </span>python3<span class="w"> </span>./tools/trace_link.py<span class="w"> </span>--et-file<span class="w"> </span>test/data/dlrm_pytorch_et/dlrm_eg_2.json<span class="w"> </span>--kineto-file<span class="w"> </span>test/data/dlrm_kineto/worker2*<span class="w"> </span>--exact-match<span class="w"> </span>--annotation<span class="w"> </span><span class="s1">&#39;enumerate(DataLoader)#_MultiProcessingDataLoaderIter.__next__&#39;</span>
$<span class="w"> </span>python3<span class="w"> </span>./tools/trace_link.py<span class="w"> </span>--et-file<span class="w"> </span>test/data/dlrm_pytorch_et/dlrm_eg_3.json<span class="w"> </span>--kineto-file<span class="w"> </span>test/data/dlrm_kineto/worker3*<span class="w"> </span>--exact-match<span class="w"> </span>--annotation<span class="w"> </span><span class="s1">&#39;enumerate(DataLoader)#_MultiProcessingDataLoaderIter.__next__&#39;</span>
$<span class="w"> </span>python3<span class="w"> </span>./tools/trace_link.py<span class="w"> </span>--et-file<span class="w"> </span>test/data/dlrm_pytorch_et/dlrm_eg_4.json<span class="w"> </span>--kineto-file<span class="w"> </span>test/data/dlrm_kineto/worker4*<span class="w"> </span>--exact-match<span class="w"> </span>--annotation<span class="w"> </span><span class="s1">&#39;enumerate(DataLoader)#_MultiProcessingDataLoaderIter.__next__&#39;</span>
$<span class="w"> </span>python3<span class="w"> </span>./tools/trace_link.py<span class="w"> </span>--et-file<span class="w"> </span>test/data/dlrm_pytorch_et/dlrm_eg_5.json<span class="w"> </span>--kineto-file<span class="w"> </span>test/data/dlrm_kineto/worker5*<span class="w"> </span>--exact-match<span class="w"> </span>--annotation<span class="w"> </span><span class="s1">&#39;enumerate(DataLoader)#_MultiProcessingDataLoaderIter.__next__&#39;</span>
$<span class="w"> </span>python3<span class="w"> </span>./tools/trace_link.py<span class="w"> </span>--et-file<span class="w"> </span>test/data/dlrm_pytorch_et/dlrm_eg_6.json<span class="w"> </span>--kineto-file<span class="w"> </span>test/data/dlrm_kineto/worker6*<span class="w"> </span>--exact-match<span class="w"> </span>--annotation<span class="w"> </span><span class="s1">&#39;enumerate(DataLoader)#_MultiProcessingDataLoaderIter.__next__&#39;</span>
$<span class="w"> </span>python3<span class="w"> </span>./tools/trace_link.py<span class="w"> </span>--et-file<span class="w"> </span>test/data/dlrm_pytorch_et/dlrm_eg_7.json<span class="w"> </span>--kineto-file<span class="w"> </span>test/data/dlrm_kineto/worker7*<span class="w"> </span>--exact-match<span class="w"> </span>--annotation<span class="w"> </span><span class="s1">&#39;enumerate(DataLoader)#_MultiProcessingDataLoaderIter.__next__&#39;</span>

$<span class="w"> </span>mkdir<span class="w"> </span>./test/data/et_plus
$<span class="w"> </span>mv<span class="w"> </span>./test/data/dlrm_pytorch_et/*_plus.json<span class="w"> </span>./test/data/et_plus/

<span class="c1"># Next, shuffle the enhanced ETs over to the chakra submodule for that transformation into Chakra goodness</span>
$<span class="w"> </span>mv<span class="w"> </span>test/data/et_plus<span class="w"> </span>../../../../../graph_frontend/chakra/
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>../../../../../graph_frontend/chakra/
$<span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>.

<span class="c1"># Almost there! The script below will make those enhanced PyTorch-ETs dance in Chakra format, getting them all prepped for a session with astrasim</span>
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>chakra.et_converter.et_converter<span class="w"> </span>--input_type<span class="w"> </span>PyTorch<span class="w"> </span>--input_filename<span class="w"> </span>et_plus/dlrm_eg_0_plus.json<span class="w"> </span>--output_filename<span class="w"> </span>et_plus/dlrm_chakra.0.et<span class="w"> </span>--num_dims<span class="w"> </span><span class="m">1</span>
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>chakra.et_converter.et_converter<span class="w"> </span>--input_type<span class="w"> </span>PyTorch<span class="w"> </span>--input_filename<span class="w"> </span>et_plus/dlrm_eg_1_plus.json<span class="w"> </span>--output_filename<span class="w"> </span>et_plus/dlrm_chakra.1.et<span class="w"> </span>--num_dims<span class="w"> </span><span class="m">1</span>
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>chakra.et_converter.et_converter<span class="w"> </span>--input_type<span class="w"> </span>PyTorch<span class="w"> </span>--input_filename<span class="w"> </span>et_plus/dlrm_eg_2_plus.json<span class="w"> </span>--output_filename<span class="w"> </span>et_plus/dlrm_chakra.2.et<span class="w"> </span>--num_dims<span class="w"> </span><span class="m">1</span>
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>chakra.et_converter.et_converter<span class="w"> </span>--input_type<span class="w"> </span>PyTorch<span class="w"> </span>--input_filename<span class="w"> </span>et_plus/dlrm_eg_3_plus.json<span class="w"> </span>--output_filename<span class="w"> </span>et_plus/dlrm_chakra.3.et<span class="w"> </span>--num_dims<span class="w"> </span><span class="m">1</span>
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>chakra.et_converter.et_converter<span class="w"> </span>--input_type<span class="w"> </span>PyTorch<span class="w"> </span>--input_filename<span class="w"> </span>et_plus/dlrm_eg_4_plus.json<span class="w"> </span>--output_filename<span class="w"> </span>et_plus/dlrm_chakra.4.et<span class="w"> </span>--num_dims<span class="w"> </span><span class="m">1</span>
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>chakra.et_converter.et_converter<span class="w"> </span>--input_type<span class="w"> </span>PyTorch<span class="w"> </span>--input_filename<span class="w"> </span>et_plus/dlrm_eg_5_plus.json<span class="w"> </span>--output_filename<span class="w"> </span>et_plus/dlrm_chakra.5.et<span class="w"> </span>--num_dims<span class="w"> </span><span class="m">1</span>
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>chakra.et_converter.et_converter<span class="w"> </span>--input_type<span class="w"> </span>PyTorch<span class="w"> </span>--input_filename<span class="w"> </span>et_plus/dlrm_eg_6_plus.json<span class="w"> </span>--output_filename<span class="w"> </span>et_plus/dlrm_chakra.6.et<span class="w"> </span>--num_dims<span class="w"> </span><span class="m">1</span>
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>chakra.et_converter.et_converter<span class="w"> </span>--input_type<span class="w"> </span>PyTorch<span class="w"> </span>--input_filename<span class="w"> </span>et_plus/dlrm_eg_7_plus.json<span class="w"> </span>--output_filename<span class="w"> </span>et_plus/dlrm_chakra.7.et<span class="w"> </span>--num_dims<span class="w"> </span><span class="m">1</span>

<span class="c1"># And, as all good things come to an end, head back home to the root directory of astrasim</span>
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>../../../

<span class="c1"># Update network topology</span>
$<span class="w"> </span>vi<span class="w"> </span>./inputs/network/analytical/FullyConnected.yml

npus_count:<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="o">]</span><span class="w">  </span><span class="c1"># number of NPUs</span>
</pre></div>
</div>
<p>Run the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a sample script that runs astrasim with the sample chakra files of DLRM that we just created</span>

$<span class="w"> </span>./build/astra_analytical/build/bin/AstraSim_Analytical_Congestion_Unaware<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--workload-configuration<span class="o">=</span>./extern/graph_frontend/chakra/et_plus/dlrm_chakra<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--system-configuration<span class="o">=</span>./inputs/system/FullyConnected.json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--network-configuration<span class="o">=</span>./inputs/network/analytical/FullyConnected.yml<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--remote-memory-configuration<span class="o">=</span>./inputs/remote_memory/analytical/no_memory_expansion.json
</pre></div>
</div>
<p>Upon completion, ASTRA-sim will display the number of cycles it took to run the simulation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ring<span class="w"> </span>of<span class="w"> </span>node<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>id:<span class="w"> </span><span class="m">0</span><span class="w"> </span>dimension:<span class="w"> </span><span class="nb">local</span><span class="w"> </span>total<span class="w"> </span>nodes<span class="w"> </span><span class="k">in</span><span class="w"> </span>ring:<span class="w"> </span><span class="m">8</span><span class="w"> </span>index<span class="w"> </span><span class="k">in</span><span class="w"> </span>ring:<span class="w"> </span><span class="m">0</span><span class="w"> </span>offset:<span class="w"> </span>1total<span class="w"> </span>nodes<span class="w"> </span><span class="k">in</span><span class="w"> </span>ring:<span class="w"> </span><span class="m">8</span>
ring<span class="w"> </span>of<span class="w"> </span>node<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>id:<span class="w"> </span><span class="m">0</span><span class="w"> </span>dimension:<span class="w"> </span><span class="nb">local</span><span class="w"> </span>total<span class="w"> </span>nodes<span class="w"> </span><span class="k">in</span><span class="w"> </span>ring:<span class="w"> </span><span class="m">8</span><span class="w"> </span>index<span class="w"> </span><span class="k">in</span><span class="w"> </span>ring:<span class="w"> </span><span class="m">0</span><span class="w"> </span>offset:<span class="w"> </span>1total<span class="w"> </span>nodes<span class="w"> </span><span class="k">in</span><span class="w"> </span>ring:<span class="w"> </span><span class="m">8</span>
...
sys<span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span>finished,<span class="w"> </span><span class="m">13271344</span><span class="w"> </span>cycles
sys<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>finished,<span class="w"> </span><span class="m">14249000</span><span class="w"> </span>cycles
</pre></div>
</div>
</section>
<section id="enable-roofline-models">
<h2>Enable Roofline Models<a class="headerlink" href="#enable-roofline-models" title="Link to this heading"></a></h2>
<p>ASTRA-sim 2.0 supports two computational performance models: the measured runtime model and the roofline model. You can enable the roofline model by setting the ‘roofline-enabled’ field to 1 in the system configuration file. Additionally, specify the local memory bandwidth (in GB/sec) and peak performance (in TFLOPS).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="s2">&quot;roofline-enabled&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;local-mem-bw&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
<span class="s2">&quot;peak-perf&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
<span class="o">...</span>
</pre></div>
</div>
<p>When creating execution traces, ensure to include the number of floating point operations and the tensor size for each compute operator.</p>
</section>
<section id="enable-communicator-groups">
<h2>Enable Communicator Groups<a class="headerlink" href="#enable-communicator-groups" title="Link to this heading"></a></h2>
<p>ASTRA-sim 2.0 supports <a class="reference external" href="https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/usage/communicators.html">communicator groups</a>.
You can pass a communicator group configuration file by specifying the file path using <code class="docutils literal notranslate"><span class="pre">--comm-group-configuration</span></code>.
If you do not pass a communicator group configuration file, by default, it will create a single group with all GPUs.
A valid communication group file is a JSON file with the following format.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;&lt;communicator_group_id&gt;&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="n">gpu_ids</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example, you can create two communicator groups with the following configuration file.
The first communicator group, with ID 0, includes GPU IDs from 0 to 3. The second communicator group, with ID 1, includes GPU IDs from 4 to 7.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
  <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="running-astra-sim.html" class="btn btn-neutral float-left" title="Run ASTRA-sim" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="argument-system-config.html" class="btn btn-neutral float-right" title="Argument ${SYSTEM_CONFIG}" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, Synergy Lab, Georgia Institute of Technology.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Read the Docs</span>
        v: latest
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        
        <dl>
            <dt>Versions</dt>
            
            
                <dd><a href="/astra-sim-docs/1.0/index.html">1.0</a></dd>
                
            
            
                <dd><a href="/astra-sim-docs/2.2/index.html">2.2</a></dd>
                
            
            
                <dd><a href="/astra-sim-docs/index.html">latest</a></dd>
                
            
        </dl>
        
    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>